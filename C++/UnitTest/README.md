# UnitTest library

## Content
This library allows you to run unit tests on your project. You will be able to check the good behaviour of your functions, by testing them one by one. 

This library gives you variable way to check your test functions:
- `TEST(function)` to run a classic test.
- `TEST(function, timeout_millis)` to run a test with a timeout (in milliseconds).
- `OTEST(function, expected_output_file)` to compare standard output with the given file.
- `OTEST(function, expected_output_file, timeout_millis)` to compare standard output with the given file with a timeout (in milliseconds).
  
In a test function, you can use these two functions :
- `assert(expression)` to check that an expression is true
- `assert_file(first_file, second_file) ` to check if first_file and second_file are identical. It can be text or binary files.

**Warning** : assert and assert_file must be used in a test function checked by TEST or OTEST, otherwise it won't work!

## Display in the terminal
Here is what the tests will display in the terminal :
- If a test passes, it displays <span style="color: rgb(0,255,0)">Success</span> and the time taken by the function
- If in a test, an assertion is false, it displays <span style="color: rgb(255,0 ,0)">Failed</span> and exits the programm. 
- If a test lasts longer than the timeout, it displays <span style="color: rgb(255,0 ,0)">Timeout</span>, the time out, and it exit the programm.
- If compared files aren't equal, it displays that the files are <span style="color: rgb(255,0 ,0)">different</span>. 
- If you test the output, it displays that your expected_output_file <span style="color: rgb(255,0 ,0)">different</span> is different from the real output. A .log file is created in order to see the real output, and understand the differences.


## Exemple of utilisation

```cpp
void myTestFunction()
{
    ...
    assert(expr); // Test an expression
    assert_file(file_1, file_2); // Check if two files are identical
    ...
}

void main(void)
{
    // Test myTestFunction
    TEST(myTestFunction);

    // Test myTestFunction with a timeout (here, the function must finish in 1 second maximum)
    TEST(myTestFunction, 1000); 

    // Test myTestFunction, and check if the output is identical of the output_expected file
    OTEST(myTestFunction, output_exected);

    // Test myTestFunction with a timeout (here, the function must finish in 1 second maximum), and check if the output is identical of the output_expected file
    OTEST(myTestFunction, output_exected, 1000); 
}
```


## Advices

We advice you to create a **separate directory** for tests. In this directory, you will have your file(s) with the tests and a Makefile to run it easily (you can also use your principal Makefile and create a command `make test` that will do the same thing). It's better to have a `main` only for tests than to run them in your principal program. Like this, you will be able to split tasks if you work on team.

## Warnings

`TEST`, `OTEST`, `assert`, `assert_file` are macros ! Therefore, **Don't name your functions, class, variables or macros like that!** If you do, it will lead to errors because the macro will replace your function, class or variable !

Also, don't use:
- `__ITS_TEST_1`, `__ITS_TEST_2`, `__ITS_TEST_3` and `__ITS_TEST_4` : they are macros used inside the library.
- `bool __its_unit_test_cpp_running`, `std::thread __its_unit_test_cpp_load` and `std::streambuf *__its_unit_stream_buffer_cout` : they are global variables used inside the library.
- `void __its_unit_test_cpp_loadingEffect()` and `void __its_unit_test_cpp_timeout(float time, std::thread &launch_func)`, they are functions used inside the library.

**If you decide to use , it can lead to unexpected behavior.**

If you use *valgrind* on the tests and a test <span style="color: red">don't success</span>, this library will generate a memory leak. If a test <span style="color: green">succeed</span>, no memory leaks will be generated by this library. Moreover, *valgrind* significantly reduces the speed of execution of your functions, then all the timout test will be wrong. **Therefore, we recommand you to use *valgrind* only if you don't use timeout tests, and if all your tests are successfull**.

## Contributors
- [Hugo LAULLIER](https://github.com/HugoLaullier)
- [Thomas RIVES](https://github.com/ThomasRives)
